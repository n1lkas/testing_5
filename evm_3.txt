#include "dos.h"
#include "conio.h"
#include "stdio.h"

int code();//Эта функция возвращает код клавиши, которая была нажата пользователем.

int keypressed();//Эта функция проверяет, была ли нажата какая-либо клавиша на клавиатуре. Если клавиша нажата, функция возвращает ненулевое значение (обычно 1), в противном случае — 0. Нажатая клавиша сохраняется в переменной key.

int main() {
    int x = 1, y = 1, ch = 0;
    textbackground(BLACK);

    window(25, 5, 55, 15);/*Начинается с точки (25, 5) — это верхний левый угол окна.
Заканчивается в точке (55, 15) — это нижний правый угол окна.*/

    clrscr();/*очищает экран консоли. Она удаляет все текстовые данные, которые отображаются на экране, и перемещает курсор в верхний левый угол (позицию координат (0, 0)).*/

    do {
        clrscr();
        gotoxy(x, y);//перемещения курсора в определённую позицию на экране консоли

        putch('*');//вывода одного символа на экран в текущей позиции курсора. После вызова этой функции курсор перемещается на следующую позицию.

        ch = code();//возвращает код клавиши, которая была нажата пользователем. 

        switch (ch) {
            case 77: { // клавиша стрелка вправо
                if ((x + 1) <= (55 - 25)) {
                    x += 1;
                }
                break;
            }
            case 75: { // клавиша стрелка влево
                if ((x - 1) >= 0) {
                    x -= 1;
                }
                break;
            }
            case 72: { // клавиша стрелка вверх
                if ((y - 1) >= 0) {
                    y -= 1;
                }
                break;
            }
            case 80: { // клавиша стрелка вниз
                if ((y + 1) <= (15 - 5)) {
                    y += 1;
                }
                break;
            }
        }
    } while (ch != 27); // выход по Esc

    return 0;
}

int keypressed() {
    union REGS r;//поля структуры REGS содержат данные, помещаемые в (из) регистры микропроцессора

    r.h.ah = 0x0B;//Устанавливает значение регистра ah в 0x0B. Это код функции DOS, который проверяет наличие нажатой клавиши. Если клавиша нажата, функция вернет значение в регистре al.

    int86(0x21, &r, &r);/*Int int86(int num, union regs *inregs, union regs *outregs);
где num – номер прерывания, inregs – входные значения регистров микропроцессора, outregs – выходные значения этих регистров. Первый параметр 0x21 указывает на номер прерывания, второй параметр (&r) — это указатель на структуру, содержащую входные данные, а третий параметр также указывает на структуру для возврата выходных данных.*/

    return r.h.al;/*Возвращает значение из регистра al, который будет ненулевым, если клавиша была нажата, и равным нулю, если клавиши не было. Значение в al соответствует коду нажатой клавиши, если она была нажата.*/
}

int code() {//для получения кода нажатой клавиши в режиме DOS
    union REGS r;

    r.h.ah = 0x7;/*Устанавливает значение регистра ah в 0x07. Это код функции DOS, который отвечает за получение кода символа клавиши, которая была нажата, но только если она была нажата после вызова этой функции. Если клавиша не была нажата, функция не вернет никакого результата.*/

    int86(0x21, &r, &r);
    return r.h.al;/*Возвращает значение из регистра al, которое содержит код нажатой клавиши. Если клавиша была нажата, этот код будет соответствовать ASCII-значению символа, иначе функция может вернуть 0*/
}